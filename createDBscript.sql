ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE;

DROP USER QLDL CASCADE;

// tao admin quan ly DU LIEU
CREATE USER QLDL IDENTIFIED BY 123;
GRANT ALL PRIVILEGES TO QLDL;

CREATE TABLE QLDL.NHANSU (
    MANV CHAR(5) PRIMARY KEY,
    HOTEN NVARCHAR2(255),
    PHAI CHAR(1),
    NGSINH DATE,
    PHUCAP INT,
    SDT VARCHAR(11),
    VAITRO NVARCHAR2(100),
    MADV VARCHAR(10)
);

CREATE TABLE QLDL.SINHVIEN(
    MASV CHAR(5)PRIMARY KEY,
    HOTEN NVARCHAR2(255),
    PHAI CHAR(1), 
    NGSINH DATE,
    DCHI NVARCHAR2(255),
    SDT VARCHAR(11),
    MACT CHAR(5),
    MANGANH VARCHAR(10),
    SOTCTL INT,
    DTBTL NUMBER(2,1) CHECK (DTBTL >= 1 AND DTBTL <= 10)
    
);

CREATE TABLE QLDL.DONVI (
    MADV VARCHAR(10)PRIMARY KEY,
    TENDV NVARCHAR2(100),
    TRGDV CHAR(5)
);

CREATE TABLE QLDL.HOCPHAN (
    MAHP CHAR(5)PRIMARY KEY,
    TENHP NVARCHAR2(100),
    SOTC INT,
    STLT INT,
    STTH INT,
    SOSVTD INT,
    MADV VARCHAR(10)
);

CREATE TABLE QLDL.KHMO (
    MAHP CHAR(5),
    HK CHAR(3),
    NAM INT,
    MACT CHAR(5),
    PRIMARY KEY (MAHP, HK, NAM, MACT)
);

CREATE TABLE QLDL.PHANCONG(
    MAGV CHAR(5),
    MAHP CHAR(5),
    HK CHAR(3),
    NAM INT,
    MACT CHAR(5),
    PRIMARY KEY (MAGV, MAHP, HK, NAM, MACT)
);

CREATE TABLE QLDL.DANGKY (
    MASV CHAR(5),
    MAGV CHAR(5),
    MAHP CHAR(5),
    HK CHAR(3),
    NAM INT,
    MACT CHAR(5),
    DIEMTH NUMBER(2,1) CHECK (DIEMTH >= 1 AND DIEMTH <= 10),
    DIEMQT NUMBER(2,1) CHECK (DIEMQT >= 1 AND DIEMQT <= 10),
    DIEMCK NUMBER(2,1) CHECK (DIEMCK >= 1 AND DIEMCK <= 10),
    DIEMTK NUMBER(2,1) CHECK (DIEMTK >= 1 AND DIEMTK <= 10),
    
    PRIMARY KEY (MASV, MAGV, MAHP, HK, NAM, MACT)
);

// TAO KHOA NGOAI
ALTER TABLE QLDL.NHANSU
ADD CONSTRAINT fk_NHANSU_DONVI FOREIGN KEY (MADV)
REFERENCES QLDL.DONVI(MADV);

ALTER TABLE QLDL.DONVI
ADD CONSTRAINT fk_DONVI_NHANSU FOREIGN KEY (TRGDV)
REFERENCES QLDL.NHANSU(MANV);

ALTER TABLE QLDL.HOCPHAN
ADD CONSTRAINT fk_HOCPHAN_DONVI FOREIGN KEY (MADV)
REFERENCES QLDL.DONVI(MADV);

ALTER TABLE QLDL.KHMO
ADD CONSTRAINT fk_KHMO_MAHP FOREIGN KEY (MAHP) 
REFERENCES QLDL.HOCPHAN(MAHP);

ALTER TABLE QLDL.PHANCONG
ADD CONSTRAINT fk_PHANCONG_KHMO FOREIGN KEY (MAHP,HK,NAM,MACT) 
REFERENCES QLDL.KHMO(MAHP,HK,NAM,MACT);

ALTER TABLE QLDL.PHANCONG
ADD CONSTRAINT fk_PHANCONG_MAGV FOREIGN KEY (MAGV) 
REFERENCES QLDL.NHANSU(MANV);

ALTER TABLE QLDL.DANGKY
ADD CONSTRAINT fk_DANGKY_MAGV FOREIGN KEY (MASV) 
REFERENCES QLDL.SINHVIEN(MASV);

ALTER TABLE QLDL.DANGKY
ADD CONSTRAINT fk_DANGKY_NHANSU FOREIGN KEY (MAGV) 
REFERENCES QLDL.NHANSU(MANV);

ALTER TABLE QLDL.DANGKY
ADD CONSTRAINT fk_DANGKY_KHMO FOREIGN KEY (MAHP, HK, NAM, MACT) 
REFERENCES QLDL.KHMO(MAHP, HK, NAM, MACT);


// INSERT DATA

--INSERT INTO DONVI (MADV, TENDV, TRGDV) 
--VALUES ('DV001', 'V?n phòng khoa', '');
--
--INSERT INTO DONVI (MADV, TENDV, TRGDV) 
--VALUES ('DV002', 'B? môn HTTT', '');
--
--INSERT INTO DONVI (MADV, TENDV, TRGDV) 
--VALUES ('DV003', 'B? môn CNPM', '');
--
--
--INSERT INTO NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV)
--VALUES ('NS001', 'Nguy?n V?n A', 'M', TO_DATE('1990-01-01', 'YYYY-MM-DD'), 3000000, '0123456789', 'Gi?ng viên', 'DV001');
--
--INSERT INTO NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV)
--VALUES ('NS002', 'Tr?n Th? B', 'F', TO_DATE('1995-05-15', 'YYYY-MM-DD'), 2500000, '0987654321', 'Nhân viên c? b?n', 'DV002');
--
--INSERT INTO NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV)
--VALUES ('NS003', 'Ph?m V?n C', 'M', TO_DATE('1988-09-20', 'YYYY-MM-DD'), 3500000, '0365487521', 'Tr??ng ??n v?', 'DV003');

-- Insert du lieu vao bang DONVI
INSERT INTO QLDL.DONVI (MADV, TENDV, TRGDV) VALUES ('DV001', N'Van phong khoa', NULL);
INSERT INTO QLDL.DONVI (MADV, TENDV, TRGDV) VALUES ('DV002', N'Bo môn HTTT', NULL);
INSERT INTO QLDL.DONVI (MADV, TENDV, TRGDV) VALUES ('DV003', N'Bo môn CNPM', NULL);
INSERT INTO QLDL.DONVI (MADV, TENDV, TRGDV) VALUES ('DV004', N'Bo môn KHMT', NULL);
INSERT INTO QLDL.DONVI (MADV, TENDV, TRGDV) VALUES ('DV005', N'Bo môn CNTT', NULL);

-- Insert du lieu vao bang NHANSU
INSERT INTO QLDL.NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV) VALUES ('NV001', N'Nguyen Van A', 'M', TO_DATE('1980-01-01', 'YYYY-MM-DD'), 1000, '0901123456', N'Nhan vien co ban', 'DV001');
INSERT INTO QLDL.NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV) VALUES ('NV002', N'Tran Thi B', 'F', TO_DATE('1985-02-02', 'YYYY-MM-DD'), 2000, '0901234567', N'Giang vien', 'DV002');
INSERT INTO QLDL.NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV) VALUES ('NV003', N'Le Van C', 'M', TO_DATE('1990-03-03', 'YYYY-MM-DD'), 1500, '0901345678', N'Giao vu', 'DV003');
INSERT INTO QLDL.NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV) VALUES ('NV004', N'Pham Thi D', 'F', TO_DATE('1983-04-04', 'YYYY-MM-DD'), 2500, '0901456789', N'Truong don vi', 'DV004');
INSERT INTO QLDL.NHANSU (MANV, HOTEN, PHAI, NGSINH, PHUCAP, SDT, VAITRO, MADV) VALUES ('NV005', N'Hoang Ven E', 'M', TO_DATE('1975-05-05', 'YYYY-MM-DD'), 3000, '0901567890', N'Truong khoa', 'DV005');

-- Cap nhat TRGDV trong bang DONVI
UPDATE QLDL.DONVI SET TRGDV = 'NV001' WHERE MADV = 'DV001';
UPDATE QLDL.DONVI SET TRGDV = 'NV002' WHERE MADV = 'DV002';
UPDATE QLDL.DONVI SET TRGDV = 'NV003' WHERE MADV = 'DV003';
UPDATE QLDL.DONVI SET TRGDV = 'NV004' WHERE MADV = 'DV004';
UPDATE QLDL.DONVI SET TRGDV = 'NV005' WHERE MADV = 'DV005';

-- Insert du lieu vao bang SINHVIEN
INSERT INTO QLDL.SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, SDT, MACT, MANGANH, SOTCTL, DTBTL) VALUES ('SV001', N'Nguyen Thi X', 'F', TO_DATE('2000-01-01', 'YYYY-MM-DD'), N'Ha Noi', '0901123123', 'CT001', 'NG001', 120, 8.5);
INSERT INTO QLDL.SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, SDT, MACT, MANGANH, SOTCTL, DTBTL) VALUES ('SV002', N'Tran Van Y', 'M', TO_DATE('2000-02-02', 'YYYY-MM-DD'), N'Ho Chi Minh', '0901232234', 'CT002', 'NG002', 130, 7.8);
INSERT INTO QLDL.SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, SDT, MACT, MANGANH, SOTCTL, DTBTL) VALUES ('SV003', N'Pham Van Z', 'M', TO_DATE('2000-03-03', 'YYYY-MM-DD'), N'Da Nang', '0901343234', 'CT003', 'NG003', 110, 9.2);
INSERT INTO QLDL.SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, SDT, MACT, MANGANH, SOTCTL, DTBTL) VALUES ('SV004', N'Le Thi P', 'F', TO_DATE('2000-04-04', 'YYYY-MM-DD'), N'Can Tho', '0901454345', 'CT004', 'NG004', 115, 6.9);
INSERT INTO QLDL.SINHVIEN (MASV, HOTEN, PHAI, NGSINH, DCHI, SDT, MACT, MANGANH, SOTCTL, DTBTL) VALUES ('SV005', N'Vo Van Q', 'M', TO_DATE('2000-05-05', 'YYYY-MM-DD'), N'Hai Phong', '0901565456', 'CT005', 'NG005', 140, 7.3);

-- Insert du lieu vao bang HOCPHAN
INSERT INTO QLDL.HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV) VALUES ('HP001', N'Toan Cao Cap', 3, 30, 15, 50, 'DV001');
INSERT INTO QLDL.HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV) VALUES ('HP002', N'Lap Trinh C', 4, 45, 20, 60, 'DV002');
INSERT INTO QLDL.HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV) VALUES ('HP003', N'Co So Du Lieu', 3, 30, 15, 55, 'DV003');
INSERT INTO QLDL.HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV) VALUES ('HP004', N'Mang May Tinh', 4, 40, 20, 45, 'DV004');
INSERT INTO QLDL.HOCPHAN (MAHP, TENHP, SOTC, STLT, STTH, SOSVTD, MADV) VALUES ('HP005', N'He Dieu Hanh', 3, 35, 20, 40, 'DV005');

-- Insert du lieu vao bang KHMO
INSERT INTO QLDL.KHMO (MAHP, HK, NAM, MACT) VALUES ('HP001', 'HK1', 2023, 'CT001');
INSERT INTO QLDL.KHMO (MAHP, HK, NAM, MACT) VALUES ('HP002', 'HK1', 2023, 'CT002');
INSERT INTO QLDL.KHMO (MAHP, HK, NAM, MACT) VALUES ('HP003', 'HK2', 2023, 'CT003');
INSERT INTO QLDL.KHMO (MAHP, HK, NAM, MACT) VALUES ('HP004', 'HK2', 2023, 'CT004');
INSERT INTO QLDL.KHMO (MAHP, HK, NAM, MACT) VALUES ('HP005', 'HK3', 2023, 'CT005');

-- Insert du lieu vao bang PHANCONG
INSERT INTO QLDL.PHANCONG (MAGV, MAHP, HK, NAM, MACT) VALUES ('NV002', 'HP001', 'HK1', 2023, 'CT001');
INSERT INTO QLDL.PHANCONG (MAGV, MAHP, HK, NAM, MACT) VALUES ('NV002', 'HP002', 'HK1', 2023, 'CT002');
INSERT INTO QLDL.PHANCONG (MAGV, MAHP, HK, NAM, MACT) VALUES ('NV003', 'HP003', 'HK2', 2023, 'CT003');
INSERT INTO QLDL.PHANCONG (MAGV, MAHP, HK, NAM, MACT) VALUES ('NV003', 'HP004', 'HK2', 2023, 'CT004');
INSERT INTO QLDL.PHANCONG (MAGV, MAHP, HK, NAM, MACT) VALUES ('NV004', 'HP005', 'HK3', 2023, 'CT005');

-- Insert du lieu vao bang DANGKY
INSERT INTO QLDL.DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV001', 'NV002', 'HP001', 'HK1', 2023, 'CT001', 8, 7.5, 8, 7.8);
INSERT INTO QLDL.DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV002', 'NV002', 'HP002', 'HK1', 2023, 'CT002', 6, 6.5, 7, 6.5);
INSERT INTO QLDL.DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV003', 'NV003', 'HP003', 'HK2', 2023, 'CT003', 9, 8.5, 9, 8.8);
INSERT INTO QLDL.DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV004', 'NV003', 'HP004', 'HK2', 2023, 'CT004', 5, 5.5, 6, 5.5);
INSERT INTO QLDL.DANGKY (MASV, MAGV, MAHP, HK, NAM, MACT, DIEMTH, DIEMQT, DIEMCK, DIEMTK) VALUES ('SV005', 'NV004', 'HP005', 'HK3', 2023, 'CT005', 7, 7.5, 8, 7.5);






